{"remainingRequest":"/home/arihayri/Projects/GLAMpipe-rewrite/nodes/Wikimedia/lookup_web_wikidata_match/source/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/arihayri/Projects/GLAMpipe-rewrite/nodes/Wikimedia/lookup_web_wikidata_match/source/src/components/DBFacet.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/arihayri/Projects/GLAMpipe-rewrite/nodes/Wikimedia/lookup_web_wikidata_match/source/src/components/DBFacet.vue","mtime":1632325376672},{"path":"/home/arihayri/Projects/GLAMpipe-rewrite/nodes/Wikimedia/lookup_web_wikidata_match/source/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/arihayri/Projects/GLAMpipe-rewrite/nodes/Wikimedia/lookup_web_wikidata_match/source/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/arihayri/Projects/GLAMpipe-rewrite/nodes/Wikimedia/lookup_web_wikidata_match/source/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/arihayri/Projects/GLAMpipe-rewrite/nodes/Wikimedia/lookup_web_wikidata_match/source/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB3ZWIgZnJvbSAnLi8uLi93ZWIuanMnCgpleHBvcnQgZGVmYXVsdCB7CgluYW1lOiAnREJGYWNldCcsCglkYXRhKCkgewoJCXJldHVybiB7CgkJCS8vZmFjZXRfdmFsdWVzOiBbXSwKCQkJZmFjZXRzOiBbXSwKCQkJZmlsdGVyczogW10sCgkJCWZhY2V0X2RhdGE6IHt9LAoJCQlmYWNldF9zZWxlY3Rpb25zOiB7fSwKCQkJZGF0YTogW10KCQl9Cgl9LAoJd2F0Y2g6IHsKCQknJHBhcmVudC5zZXR0aW5ncyc6IGZ1bmN0aW9uKCkgewoJCQljb25zb2xlLmxvZygnY29uZmlnIHVwZGF0ZWQnKQoJCQl0aGlzLnBhcnNlRmFjZXRzKCkKCQkJdGhpcy5sb2FkRmFjZXREYXRhKCkKCQl9Cgl9LAoJbWV0aG9kczogewoJCXNldEZhY2V0VmFsdWVzKHZhbHVlcykgewoJCQlmb3IodmFyIGtleSBpbiB2YWx1ZXMpIHsKCQkJCXZhciBmYWNldCA9IHRoaXMuZmFjZXRzLmZpbmQoZiA9PiBmLmtleSA9PT0ga2V5KQoJCQkJZmFjZXQudmFsdWVzID0gdmFsdWVzCgkJCX0KCQl9LAoJCXNldEZhY2V0U2VsZWN0aW9uKGZhY2V0LCB2YWx1ZSkgewoJCQlpZihmYWNldC5rZXkgaW4gdGhpcy5mYWNldF9zZWxlY3Rpb25zKSB7CgkJCQlpZih0aGlzLmZhY2V0X3NlbGVjdGlvbnNbZmFjZXQua2V5XS5pbmNsdWRlcyh2YWx1ZSkpIHsKCQkJCQkvLyByZW1vdmUgdmFsdWUKCQkJCQl0aGlzLmZhY2V0X3NlbGVjdGlvbnNbZmFjZXQua2V5XSA9IHRoaXMuZmFjZXRfc2VsZWN0aW9uc1tmYWNldC5rZXldLmZpbHRlcihpdGVtID0+IGl0ZW0gIT09IHZhbHVlKQoJCQkJfSBlbHNlIHsKCQkJCQl0aGlzLmZhY2V0X3NlbGVjdGlvbnNbZmFjZXQua2V5XS5wdXNoKHZhbHVlKQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJdGhpcy4kc2V0KHRoaXMuZmFjZXRfc2VsZWN0aW9ucywgZmFjZXQua2V5LCBbdmFsdWVdKQoJCQkJLy90aGlzLmZhY2V0X3NlbGVjdGlvbnNbZmFjZXQua2V5XSA9IFt2YWx1ZV0KCQkJfQoJCX0sCgkJYXN5bmMgbG9hZEZhY2V0RGF0YSgpIHsKCQkJdmFyIGZhY2V0X2ZpZWxkcyA9IHRoaXMuZmFjZXRzLm1hcChmID0+IGYua2V5KQoJCQl2YXIgcXVlcnkgPSB3ZWIuZ2V0VVJMUXVlcnlQYXJhbXNBc1N0cmluZygpCgkJCXZhciByZXNwb25zZSA9IGF3YWl0IHdlYi5nZXRGYWNldFZhbHVlcyh0aGlzLiRwYXJlbnQuc2V0dGluZ3MuY29sbGVjdGlvbiwgZmFjZXRfZmllbGRzLmpvaW4oJ3wnKSwgcXVlcnkpCgkJCXRoaXMuZmFjZXRfZGF0YSA9IHJlc3BvbnNlLmRhdGFbMF0KCQkJLy90aGlzLnNldEZhY2V0VmFsdWVzKHJlc3BvbnNlLmRhdGFbMF0pCgkJCS8vYXhpb3MuZ2V0KGAvYXBpL3YyL2NvbGxlY3Rpb25zLyR7dGhpcy4kcGFyZW50LnNldHRpbmdzLmNvbGxlY3Rpb259L2ZhY2V0P2ZpZWxkcz0ke2ZhY2V0X2ZpZWxkcy5qb2luKCcsJyl9JHt1cmx9YCkudGhlbihyZXN1bHQgPT4gewoJCQkJLy90aGlzLmZhY2V0cyA9IE9iamVjdC5rZXlzKHJlc3VsdC5kYXRhWzBdKQoJCQkJLy90aGlzLmZhY2V0X2RhdGEgPSByZXN1bHQuZGF0YVswXQoJCQkJLy90aGlzLnNldEZhY2V0VmFsdWVzKHJlc3VsdC5kYXRhWzBdKQoJCQkvL30pCgkJfSwKCQlwYXJzZUZhY2V0cygpIHsKCQkJdGhpcy5mYWNldHMgPSBbXQoJCQlpZih0aGlzLiRwYXJlbnQuc2V0dGluZ3MuZmlsdGVycykgewoJCQkJZm9yKHZhciBmIG9mIHRoaXMuJHBhcmVudC5zZXR0aW5ncy5maWx0ZXJzKSB7CgkJCQkJZi52YWx1ZXMgPSBbXQoJCQkJCWlmKGYubW9kZSA9PSAnZmFjZXQnKSB7CgkJCQkJCXRoaXMuZmFjZXRzLnB1c2goZikKCQkJCQkJLy90aGlzLiRzZXQodGhpcy5mYWNldF92YWx1ZXMsIGYua2V5LCBbXSkgLy8gbWFrZSBrZXkgcmVhY3RpdmUKCQkJCQl9CgkJCQkJaWYoZi5tb2RlID09ICdmaWx0ZXInKSB0aGlzLmZpbHRlcnMucHVzaChmKQoJCQkJfQoJCQl9CgkJfSwKCQlyZXNldCgpIHsKCQkJY29uc29sZS5sb2coJ2ZhY2V0IHJlc2V0JykKCQkJZm9yKHZhciBmYWNldCBpbiB0aGlzLmZhY2V0X3NlbGVjdGlvbnMpIHsKCQkJCWNvbnNvbGUubG9nKGZhY2V0KQoJCQkJdGhpcy5mYWNldF9zZWxlY3Rpb25zW2ZhY2V0XSA9IFtdCgkJCX0KCQkJdGhpcy4kcm91dGVyLnB1c2goeyBxdWVyeTogdGhpcy5mYWNldF9zZWxlY3Rpb25zfSkKCQkJdGhpcy5sb2FkRmFjZXREYXRhKCkKCQl9LAoJCWFzeW5jIHVwZGF0ZURhdGEoZmFjZXQsIGZhY2V0X3ZhbHVlKSB7CgkJCXRoaXMuc2V0RmFjZXRTZWxlY3Rpb24oZmFjZXQsIGZhY2V0X3ZhbHVlKQoJCQl0aGlzLiRyb3V0ZXIucHVzaCh7IHF1ZXJ5OiB0aGlzLmZhY2V0X3NlbGVjdGlvbnN9KQoJCQl0aGlzLmxvYWRGYWNldERhdGEoKQoJCX0KCgl9Cn0KCg=="},{"version":3,"sources":["DBFacet.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAqBA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"DBFacet.vue","sourceRoot":"src/components","sourcesContent":["<style>\n.pointer {\n\tcursor: pointer\n}\n</style>\n\n<template>\n  <div class=\"hello\">\n\t<b-card v-for=\"facet in facets\" v-bind:key=\"facet.key\" :title=\"facet.title\">\n\t\t<b-list-group v-for=\"fdata in facet_data[facet.key]\" :key=\"fdata._id\">\n\t\t\t<b-list-group-item class=\"pointer\" @click=\"updateData(facet, fdata._id)\">{{fdata._id}} ({{fdata.count}})\n\t\t\t</b-list-group-item>\n\t\t</b-list-group>\n\n\t</b-card>\n\n\n  </div>\n</template>\n\n<script>\nimport web from './../web.js'\n\nexport default {\n\tname: 'DBFacet',\n\tdata() {\n\t\treturn {\n\t\t\t//facet_values: [],\n\t\t\tfacets: [],\n\t\t\tfilters: [],\n\t\t\tfacet_data: {},\n\t\t\tfacet_selections: {},\n\t\t\tdata: []\n\t\t}\n\t},\n\twatch: {\n\t\t'$parent.settings': function() {\n\t\t\tconsole.log('config updated')\n\t\t\tthis.parseFacets()\n\t\t\tthis.loadFacetData()\n\t\t}\n\t},\n\tmethods: {\n\t\tsetFacetValues(values) {\n\t\t\tfor(var key in values) {\n\t\t\t\tvar facet = this.facets.find(f => f.key === key)\n\t\t\t\tfacet.values = values\n\t\t\t}\n\t\t},\n\t\tsetFacetSelection(facet, value) {\n\t\t\tif(facet.key in this.facet_selections) {\n\t\t\t\tif(this.facet_selections[facet.key].includes(value)) {\n\t\t\t\t\t// remove value\n\t\t\t\t\tthis.facet_selections[facet.key] = this.facet_selections[facet.key].filter(item => item !== value)\n\t\t\t\t} else {\n\t\t\t\t\tthis.facet_selections[facet.key].push(value)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.$set(this.facet_selections, facet.key, [value])\n\t\t\t\t//this.facet_selections[facet.key] = [value]\n\t\t\t}\n\t\t},\n\t\tasync loadFacetData() {\n\t\t\tvar facet_fields = this.facets.map(f => f.key)\n\t\t\tvar query = web.getURLQueryParamsAsString()\n\t\t\tvar response = await web.getFacetValues(this.$parent.settings.collection, facet_fields.join('|'), query)\n\t\t\tthis.facet_data = response.data[0]\n\t\t\t//this.setFacetValues(response.data[0])\n\t\t\t//axios.get(`/api/v2/collections/${this.$parent.settings.collection}/facet?fields=${facet_fields.join(',')}${url}`).then(result => {\n\t\t\t\t//this.facets = Object.keys(result.data[0])\n\t\t\t\t//this.facet_data = result.data[0]\n\t\t\t\t//this.setFacetValues(result.data[0])\n\t\t\t//})\n\t\t},\n\t\tparseFacets() {\n\t\t\tthis.facets = []\n\t\t\tif(this.$parent.settings.filters) {\n\t\t\t\tfor(var f of this.$parent.settings.filters) {\n\t\t\t\t\tf.values = []\n\t\t\t\t\tif(f.mode == 'facet') {\n\t\t\t\t\t\tthis.facets.push(f)\n\t\t\t\t\t\t//this.$set(this.facet_values, f.key, []) // make key reactive\n\t\t\t\t\t}\n\t\t\t\t\tif(f.mode == 'filter') this.filters.push(f)\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\treset() {\n\t\t\tconsole.log('facet reset')\n\t\t\tfor(var facet in this.facet_selections) {\n\t\t\t\tconsole.log(facet)\n\t\t\t\tthis.facet_selections[facet] = []\n\t\t\t}\n\t\t\tthis.$router.push({ query: this.facet_selections})\n\t\t\tthis.loadFacetData()\n\t\t},\n\t\tasync updateData(facet, facet_value) {\n\t\t\tthis.setFacetSelection(facet, facet_value)\n\t\t\tthis.$router.push({ query: this.facet_selections})\n\t\t\tthis.loadFacetData()\n\t\t}\n\n\t}\n}\n\n</script>\n"]}]}