{"remainingRequest":"/home/arihayri/Projects/GLAMpipe-rewrite/nodes/Wikimedia/lookup_web_wikidata_match/source/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/arihayri/Projects/GLAMpipe-rewrite/nodes/Wikimedia/lookup_web_wikidata_match/source/src/components/DBDataTable.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/arihayri/Projects/GLAMpipe-rewrite/nodes/Wikimedia/lookup_web_wikidata_match/source/src/components/DBDataTable.vue","mtime":1634813820917},{"path":"/home/arihayri/Projects/GLAMpipe-rewrite/nodes/Wikimedia/lookup_web_wikidata_match/source/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/arihayri/Projects/GLAMpipe-rewrite/nodes/Wikimedia/lookup_web_wikidata_match/source/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/arihayri/Projects/GLAMpipe-rewrite/nodes/Wikimedia/lookup_web_wikidata_match/source/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/arihayri/Projects/GLAMpipe-rewrite/nodes/Wikimedia/lookup_web_wikidata_match/source/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgppbXBvcnQgd2ViIGZyb20gJy4vLi4vd2ViLmpzJwoKZXhwb3J0IGRlZmF1bHQgewoJbmFtZTogJ0RCRGF0YVRhYmxlJywKCXByb3BzOiBbJ3Nob3dfb25seV9ub25fbWF0Y2hlZCddLAoJZGF0YSgpIHsKCQlyZXR1cm4gewoJCQlzdGF0czoge3RvdGFsOi0xLCB1bm1hdGNoZWQ6MH0sCgkJCWRhdGE6IFtdLAoJCQlmaWVsZHM6IFtdLAoJCQlzdWdnZXN0aW9uc19maWVsZDogJycsCgkJCW1hdGNoX2ZpZWxkOiAnJwoJCX0KCX0sCgltZXRob2RzOiB7CgkJZm9ybWF0UmVjb25jaWxpYXRpb25SZXN1bHQod2RfcmVzdWx0LCBkYXRhKSB7CgkJCXZhciBvdXQgPSAnPHRhYmxlPicKCQkJaWYoZGF0YVt0aGlzLm1hdGNoX2ZpZWxkXSkgewoJCQkJcmV0dXJuIGA8YnV0dG9uIGNsYXNzPSJidG4gYnRuLW91dGxpbmUtcHJpbWFyeSIgb25jbGljaz0id2luZG93LnRhYmxlLnNldFNlbGVjdGlvbignJHtkYXRhLl9pZH0nLCAnJykiPkNoYW5nZSBzZWxlY3Rpb24gPC9idXR0b24+ICgke3dkX3Jlc3VsdC5yZXN1bHQubGVuZ3RofSBzdWdnZXN0aW9ucylgCgkJCX0KCQkJaWYod2RfcmVzdWx0LnJlc3VsdCkgewoJCQkJZm9yKHZhciByIG9mIHdkX3Jlc3VsdC5yZXN1bHQpIHsKCQkJCQlpZihyLm1hdGNoKSB7CgkJCQkJCW91dCArPSBgPGIgY2xhc3M9InRleHQtaW5mbyI+JHtyLm5hbWV9ICR7ci5pZH08L2I+YAoJCQkJCX0gZWxzZSB7CgkJCQkJCWlmKHIuc2NvcmUgPT0gMTAwKQoJCQkJCQkJb3V0ICs9IGA8dHI+PHRkPjxiPiR7ci5uYW1lfTwvYj48L3RkPjx0ZD4gJHtyLmlkfSA8L3RkPjx0ZD4gJHtyLnNjb3JlfTwvdGQ+PHRkPjxidXR0b24gb25jbGljaz0id2luZG93LnRhYmxlLnNldFNlbGVjdGlvbignJHtkYXRhLl9pZH0nLCAnJHtyLmlkfScpIiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IiB0eXBlPSJidXR0b24iPnNlbGVjdDwvYnV0dG9uPjwvdGQ+PC90cj5gCgkJCQkJCWVsc2UKCQkJCQkJCW91dCArPSBgPHRyPjx0ZD4ke3IubmFtZX08L3RkPjx0ZD4gJHtyLmlkfSAke3Iuc2NvcmV9PC90ZD48L3RyPmAKCQkJCQl9CgkJCQkJLy92YXIgbWF0Y2hlZF9ieSA9ICcnCgkJCQl9CgkJCX0KCQkJcmV0dXJuIG91dCArICc8L3RhYmxlPicKCQl9LAoJCWZvcm1hdFJlY29uY2lsaWF0aW9uTWF0Y2god2RfbWF0Y2gsIGRhdGEpIHsKCQkJcmV0dXJuIHRoaXMucGlja1dJRCh3ZF9tYXRjaCwgZGF0YSkKCQl9LAoJCXBpY2tXSUQod2lkLCBkYXRhKSB7CgkJCXZhciBvdXQgPSAnJwoJCQlpZihkYXRhW3RoaXMuc3VnZ2VzdGlvbnNfZmllbGRdLnJlc3VsdCkgewoJCQkJZm9yKHZhciByIG9mIGRhdGFbdGhpcy5zdWdnZXN0aW9uc19maWVsZF0ucmVzdWx0KSB7CgkJCQkJaWYoci5pZCA9PSB3aWQpIHsKCQkJCQkJb3V0ICs9IGA8YiBjbGFzcz0idGV4dC1pbmZvIj4ke3IubmFtZX0gKDxhIGhyZWY9IiI+JHtyLmlkfTwvYT4pPC9iPmAKCQkJCQl9CgkJCQl9CgkJCX0KCQkJcmV0dXJuIG91dAoJCX0sCgkJYXN5bmMgc2V0U2VsZWN0aW9uKGRvY19pZCwgc2VsZWN0aW9uKSB7CgkJCWNvbnNvbGUubG9nKGRvY19pZCkKCQkJdmFyIGRhdGEgPSB7fQoKCQkJZGF0YVt0aGlzLm1hdGNoX2ZpZWxkXSA9IHNlbGVjdGlvbgoJCQlhd2FpdCB3ZWIuc2V0RGF0YSh0aGlzLiRwYXJlbnQuc2V0dGluZ3MuY29sbGVjdGlvbiwgZG9jX2lkLCBkYXRhKQoJCQlsZXQgcmVzdWx0ID0gYXdhaXQgd2ViLmdldERhdGEoKQoJCQl0aGlzLmRhdGEgPSByZXN1bHQuZGF0YS5kYXRhCgkJfQoJfSwKCgl3YXRjaDogewoJCXNob3dfb25seV9ub25fbWF0Y2hlZDogYXN5bmMgZnVuY3Rpb24oKSB7CgkJCWxldCByZXN1bHQgPSBhd2FpdCB3ZWIuZ2V0RGF0YSh0aGlzLnNob3dfb25seV9ub25fbWF0Y2hlZCkKCQkJdGhpcy5kYXRhID0gcmVzdWx0LmRhdGEuZGF0YQoJCX0KCX0sCgltb3VudGVkOiBhc3luYyBmdW5jdGlvbiAoKSB7CgkJd2luZG93LnRhYmxlID0gdGhpczsgLy8gaGFja2lzaDogZXhwb3NlIG1ldGhvZHMgZm9yIHBsYWluIGpzICJzZWxlY3QiIGJ1dHRvbnMKCQljb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpOwoJCXRoaXMuZmllbGRzID0gcGFyYW1zLmdldCgiZmllbGRzIikuc3BsaXQoJywnKTsKCQl0aGlzLnN1Z2dlc3Rpb25zX2ZpZWxkID0gcGFyYW1zLmdldCgic3VnZ2VzdGlvbnMiKQoJCXRoaXMubWF0Y2hfZmllbGQgPSBwYXJhbXMuZ2V0KCJtYXRjaCIpCgkJdGhpcy5maWVsZHMgPSB0aGlzLmZpZWxkcy5jb25jYXQoW3RoaXMuc3VnZ2VzdGlvbnNfZmllbGQsIHRoaXMubWF0Y2hfZmllbGRdKQoJCWxldCByZXN1bHQgPSBhd2FpdCB3ZWIuZ2V0RGF0YSh0aGlzLnNob3dfb25seV9ub25fbWF0Y2hlZCkKCQl0aGlzLmRhdGEgPSByZXN1bHQuZGF0YS5kYXRhCgkJdGhpcy5zdGF0cyA9IGF3YWl0IHdlYi5nZXRTdGF0cygpCgl9Cn0KCg=="},{"version":3,"sources":["DBDataTable.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAoBA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"DBDataTable.vue","sourceRoot":"src/components","sourcesContent":["<template>\n\t<div class=\"data\">\n\t\ttotal: {{stats.total}}\n\t\t<div v-if=\"stats.non_matched == 0\" class=\"alert alert-success\">joo</div>\n\t\t<b-table striped hover :items=\"data\" :fields=\"fields\">\n\n\t\t\t<template v-slot:[`cell(${suggestions_field})`]=\"data\">\n\t\t\t\t<div v-html=\"formatReconciliationResult(data.value, data.item)\"></div>\n\t\t\t</template>\n\t\t\t<template v-slot:[`cell(${match_field})`]=\"data\">\n\t\t\t\t<div v-html=\"formatReconciliationMatch(data.value, data.item)\"></div>\n\t\t\t</template>\n\n\t\t</b-table>\n\n\t</div>\n</template>\n\n<script>\n\nimport web from './../web.js'\n\nexport default {\n\tname: 'DBDataTable',\n\tprops: ['show_only_non_matched'],\n\tdata() {\n\t\treturn {\n\t\t\tstats: {total:-1, unmatched:0},\n\t\t\tdata: [],\n\t\t\tfields: [],\n\t\t\tsuggestions_field: '',\n\t\t\tmatch_field: ''\n\t\t}\n\t},\n\tmethods: {\n\t\tformatReconciliationResult(wd_result, data) {\n\t\t\tvar out = '<table>'\n\t\t\tif(data[this.match_field]) {\n\t\t\t\treturn `<button class=\"btn btn-outline-primary\" onclick=\"window.table.setSelection('${data._id}', '')\">Change selection </button> (${wd_result.result.length} suggestions)`\n\t\t\t}\n\t\t\tif(wd_result.result) {\n\t\t\t\tfor(var r of wd_result.result) {\n\t\t\t\t\tif(r.match) {\n\t\t\t\t\t\tout += `<b class=\"text-info\">${r.name} ${r.id}</b>`\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(r.score == 100)\n\t\t\t\t\t\t\tout += `<tr><td><b>${r.name}</b></td><td> ${r.id} </td><td> ${r.score}</td><td><button onclick=\"window.table.setSelection('${data._id}', '${r.id}')\" class=\"btn btn-primary\" type=\"button\">select</button></td></tr>`\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tout += `<tr><td>${r.name}</td><td> ${r.id} ${r.score}</td></tr>`\n\t\t\t\t\t}\n\t\t\t\t\t//var matched_by = ''\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn out + '</table>'\n\t\t},\n\t\tformatReconciliationMatch(wd_match, data) {\n\t\t\treturn this.pickWID(wd_match, data)\n\t\t},\n\t\tpickWID(wid, data) {\n\t\t\tvar out = ''\n\t\t\tif(data[this.suggestions_field].result) {\n\t\t\t\tfor(var r of data[this.suggestions_field].result) {\n\t\t\t\t\tif(r.id == wid) {\n\t\t\t\t\t\tout += `<b class=\"text-info\">${r.name} (<a href=\"\">${r.id}</a>)</b>`\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn out\n\t\t},\n\t\tasync setSelection(doc_id, selection) {\n\t\t\tconsole.log(doc_id)\n\t\t\tvar data = {}\n\n\t\t\tdata[this.match_field] = selection\n\t\t\tawait web.setData(this.$parent.settings.collection, doc_id, data)\n\t\t\tlet result = await web.getData()\n\t\t\tthis.data = result.data.data\n\t\t}\n\t},\n\n\twatch: {\n\t\tshow_only_non_matched: async function() {\n\t\t\tlet result = await web.getData(this.show_only_non_matched)\n\t\t\tthis.data = result.data.data\n\t\t}\n\t},\n\tmounted: async function () {\n\t\twindow.table = this; // hackish: expose methods for plain js \"select\" buttons\n\t\tconst params = new URLSearchParams(window.location.search);\n\t\tthis.fields = params.get(\"fields\").split(',');\n\t\tthis.suggestions_field = params.get(\"suggestions\")\n\t\tthis.match_field = params.get(\"match\")\n\t\tthis.fields = this.fields.concat([this.suggestions_field, this.match_field])\n\t\tlet result = await web.getData(this.show_only_non_matched)\n\t\tthis.data = result.data.data\n\t\tthis.stats = await web.getStats()\n\t}\n}\n\n</script>\n"]}]}